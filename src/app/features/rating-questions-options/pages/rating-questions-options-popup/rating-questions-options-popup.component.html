<div class="overlay">
  <div class="popup-container">
    <div class="popup-header">
      <h2 class="modal-title">
        <i class="fas fa-edit"></i>
        {{ isEditMode ? "Edit" : "Create" }} Rating Question Option
      </h2>
      <button class="close-btn" (click)="onClose()">Ã—</button>
    </div>

    <form [formGroup]="providerForm" (ngSubmit)="onSubmit()">
      <div class="form-section">
        <!-- Row 1 -->
        <div class="form-row">
          <div class="form-group">
            <label>Question Type <span class="required">*</span></label>
            <ng-select
              [items]="questionTypes"
              bindLabel="QuestionType"
              bindValue="RatingQuestionTypeId"
              placeholder="Select Question Type"
              formControlName="RatingQuestionTypeId"
              [clearable]="false"
              [searchable]="true"
            ></ng-select>
            <div
              *ngIf="
                providerForm.get('RatingQuestionTypeId')?.invalid &&
                providerForm.get('RatingQuestionTypeId')?.touched
              "
              class="error-message"
            >
              Question Type is required.
            </div>
          </div>

          <div class="form-group">
            <label>Question Option <span class="required">*</span></label>
            <ng-container
              *ngIf="predefinedOptions.length > 0; else manualInput"
            >
              <ng-select
                [items]="predefinedOptions"
                bindLabel=""
                bindValue=""
                placeholder="Select Option"
                formControlName="QuestionOption"
                [clearable]="false"
              ></ng-select>
            </ng-container>

            <ng-template #manualInput>
              <input
                type="text"
                class="form-control"
                formControlName="QuestionOption"
                required
              />
            </ng-template>
            <div
              *ngIf="
                providerForm
                  .get('QuestionOption')
                  ?.hasError('invalidDropdownValue') &&
                providerForm.get('QuestionOption')?.touched
              "
              class="error-message"
            >
              Invalid option selected. Please choose from the dropdown.
            </div>
          </div>
        </div>

        <!-- Row 2 -->
        <div class="form-row">
          <div class="form-group">
            <label>Qualifying Prompt</label>
            <textarea
              class="form-control"
              rows="2"
              formControlName="QualifyingPrompt"
            ></textarea>
          </div>

          <div class="form-group">
            <label>Rating Value <span class="required">*</span></label>
            <input
              type="number"
              class="rating-value"
              formControlName="RatingValue"
              required
            />
            <div
              *ngIf="
                providerForm.get('RatingValue')?.invalid &&
                providerForm.get('RatingValue')?.touched
              "
              class="error-message"
            >
              <div
                *ngIf="providerForm.get('RatingValue')?.hasError('required')"
              >
                Rating value is required.
              </div>
              <div
                *ngIf="
                  providerForm.get('RatingValue')?.hasError('min') ||
                  providerForm.get('RatingValue')?.hasError('max')
                "
              >
                Rating must be between 1 and 10.
              </div>
              <div *ngIf="providerForm.get('RatingValue')?.hasError('pattern')">
                Only numeric values are allowed.
              </div>
            </div>
          </div>
        </div>

        <!-- Row 3: Toggles -->
        <div class="form-row toggles-row">
          <div class="form-group is-active-group">
            <label class="toggle-label">Is Active?</label>
            <label class="toggle-switch">
              <input type="checkbox" formControlName="IsActive" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="form-group is-active-group">
            <label class="toggle-label">Note Required?</label>
            <label class="toggle-switch">
              <input type="checkbox" formControlName="IsNoteRequired" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="form-group is-active-group">
            <label class="toggle-label">Raise Flag?</label>
            <label class="toggle-switch">
              <input type="checkbox" formControlName="DoRaiseFlag" />
              <span class="slider"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="form-actions">
        <button type="button" class="btn cancel-btn" (click)="onClose()">
          Cancel
        </button>
        <button
          type="submit"
          class="btn submit-btn"
          [disabled]="providerForm.invalid"
        >
          {{ isEditMode ? "Update" : "Save" }}
        </button>
      </div>
    </form>
  </div>
</div>
